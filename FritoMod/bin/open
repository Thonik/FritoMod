#!/bin/bash
PATH=/bin:/usr/bin:$HOME/bin:$FM_ROOT

source fm-library.sh
make_root

case $1 in
	-f)
		FORCE=true
		shift
	;;
esac;

name=$1
if [ -f $1 ]; then
	name=$1
elif [ -f $1.lua ]; then
	name=$1.lua
elif [ -f $1.xml ]; then
	name=$1.xml
elif [ ! "$FORCE" ]; then
	error "file not found or is not a file: $1"
fi;

l=`readlink -f $root | wc -m`
let l++
path=`readlink -f $name | trim $l`
comp=${path%%/*}
comp_path=${path#*/}

test_path="$root/$comp""_Tests"
tests="$test_path/$comp_path"
if `echo $comp_path | grep -q '/'`; then
	mkdir -p $test_path/${comp_path%/*}
else
	mkdir -p $test_path
fi
if [ ! -e $tests ]; then
	cat >$tests <<EOF
local Suite=CreateTestSuite("${path%.*}");

function Suite:TestFoo()
	-- TODO: Write this test.
end;
EOF
fi
$EDITOR $name $tests
